newsgroups alt path sundogtiacnet europaenggtefsdcom emory swrinde pipex sunic eunet uunet iatholonetnet clafave clafave iatholonetnet christopher r lafave subject hacking atm messageid cscvtlut iatholonetnet organization holonet national internet access system modem reference vev p lucyinfinet date sun jul  gmt line magnetic stripe technology figure listing end widespread use magnetic card adhere welldefined standard describe physical magnetic characteristic magnetic stripe plastic card standard outline specification storage format information interchange preclude encoding technique additional data track specific application case make sense adhere least basic constraint give choice using commercially available magnetic encoders application technique used encoding magnetic card known  twofrequency coherent phase recording  allowing representation singlechannel selfclocking serial data methodology generally referred ff selfclocking achieved combining data clock bit together continuous synchronous sequence scheme intermediate flux transition signifies one bit absence intermediate flux transition denotes zero bit three data track defined use standard magnetic card posse different bit density encoded character set average bit density track bit per inch bpi track character made six data bit odd parity bit encoded leastsignificant bit first parity bit last yielding character set taking number bit per inch number bit per character see track capacity hold character track bit density bpi track us bpi track allow representation numericonly character set character track encoded using bit binarycoded decimal subset odd parity like track encoded least significant bit first parity bit last lower density track allows numeric character numerics squeezed onto track actual number usable character fewer since also start sentinel end sentinel lrc character though sometimes magnetic card moved past read head mechanically application rely manually moving card either slotted reader insertiontype reader typically swipe rate  inch per second ip ip fastest card reader handle course moving card hand result varying absolute card velocity also introduce incremental speed change card accelerates decelerates past pickup ff scheme forgiving speed fluctuation track fundamental data format similar consists following element first leading zero bit encoded indicate presence encoded magnetic card provide synchronization pulse read head electronics ultimately controller next start sentinel character encoded indicates start actual data coded data follows next end sentinel terminates data portion card followed lrc byte used error detection lrc essentially horizontal parity calculated exclusiveor data bit start sentinel end sentinel inclusive finally trailing zero follow lrc fill remainder card anatomy magnetic card magnetic track inherent characteristic based detail code set bit character density international organization mastercard visa impose additional constraits participating member standard exist bank debit card atm card well rule specify exact content format data field aech track well intended us track naturally nonfinancial us necessary comply standard dedicated us access control people tracking material tracking adhering minimal standard adequate mostoftenused track track although offer lowest inform ation density three contains information normally used credit card transaction customer name required track must used since track permit alphanumeric data track specified numericonly data unique intended change able data consequently may read may rewritten transactionhandling equipment multitude data fileds contained various track figure show brief rundown generally placed track real card reader recovery magnetically encoded ff data accomplished directly use microcontroller particular difficulty deciphering raw ff data stream many early magnetic read head contained nothing signal amplifier line driver artifact since modern magnetic read head contain integ rated ff bit recovery circuitry interface host controller standard fashion using three wire card present clock data read head usually rely single chip perform linear signal conditioning sychronization recovery individual bit data stream mag tek ic representative type data recovery circuit functionality depicted figure linear conditioning consists raising level magnetic pickup input signal rejecting commonmode noise conditioning detecting signal finally providing digital output susequent processing enabledisable counter provide initialization recovery section recovery section lock onto data rate recovers individual data bit data stream oscillator section provides clock recov ery section enabledisable timer card present go low flux reversal seen magnetic pickup return high m last flux reversal strobe line signal data valid active low data pin indicates one bit low raw ff data also picked directly chip data rate highdensity track scanned ip come bit per second bps result transfer rate character per second bit element used track character per second using bit element track either case translates new bit arriving controller every u microsecond even anemic controller able keep resonably good coding techni ques problem handling entire data sampling phase interruptdriven basis lowdensity track data flow pes trian bps yielding bit character per second new bit every u since dualtrack read head provide track track data indicates handling track simultaneously feasible interrupt control keep mind ip rather fast scan rate  ip probably realistic limit magnetic bit storm approaching problem decoding magnetic card pay spend time looking overall picture starting write code first glance would seem organizing data prevailing element size sampling interval would make decoding easier could easily done ignoring leading zero actual data storage comm encing first one bit course approach assumes getting good data fact data recovery handled using wellproven hard ware make assumption valid need decode card forward direction going thing described make sense reduces coding effort trivial exercise support reverse decoding optimal solution considered tradeoff able decode magnetic card forward reverse direction decided structure program work equally well either direction cost slight increase initial complexity first step decoding acquire serial bit stream done using dedicated sample loop little work using interrupt processing since idea regardless detail decided use sample loop demonstration program listing code simply record incoming data stream deposit data sample buffer byte time sampling begin card present return idle incomplete byte partially assembled time sampling terminates simply discarded abundance leading trailing zero allows losing bit either end causing problem sampling interval completes control transferred decoding algorithm presented listing track decode algorithm consists nothing initialization essence decode logic limiting gyration contained main body routine make logic easy follow permit code handle decoding either forward reverse direction initial entry point assumes forward decode attempt set necessary flag pointer counter jumping main initial ization code initialization sample buffer scanned first one bit time bit element assembled parity correct character code check start sentinel code proceeds start pulling successive data element sample buffer data element end sentinel character translated ascii stored decode buffer end sentinel detected program extract next character assumed lrc byte finally check calculated lrc value zero check balance included execution loop include thing parity cumulative lrc checking make sure nt run sample everything check program terminates return dptr pointing decoded data buffer character count contained acc decode failure occur test performed direction flag attempt forward decode routine jump reverse initialization entry point reverse entry similar forward decode entry set sample pointer end sample buffer set direction flag indicate reverse operation routine contained intermediate layer shown listing meaning operation routine apparent key routine section getbit pick next bit sample buffer essentially restoring sequential nature initial magnetic bit stream findstart used synchronize first one bit getchar first check make sure nt run sample assembles next bit data element parity test lrc calculation problem encountered sent back caller handled storechar translates deposit data character respective location decodeddata buffer increment character counter listing show lowlevel code routine perform rudiment ary function operate accordance direction flag indexptr either increment decrement sample pointer positionbit likewise either right left shift locatebit return state least significant bit accumulator go ahead take swipe let touch additional point may immediately apparent signing storing sampled data continuous stream make sample routine work equally well various bit configuration used different recording track would easily attained tried generate particular element format sample time furthermore look difference encoded character set bit format different track find differ area minor change defined start sentinel number bit per element character translation method decode routine shown could easily coerced handle decoding standard magnetic track matter fact recoding redefining hardcoded constant variable could set particular data track execution time invoking decode function would save program memory would also allow use routine comfortable  figure  track ssfc pan f name f additional data eslrc  note track limited character including s e lrc mastercard pan variable character maximum visa character including mod check digit s start sentinel fc format code f field separator e end sentinel lrc longitudinal redundency check character pan primary account number digit max name alphanumeric character max additional data expiration date restriction type offset pvn  track ssfc pan f additional data eslrc  s start sentinel hex b f field separator hex e end sentinel hex f lrc longitudinal redundency check character pan primary account number digit max additional data expiration date restriction type offset pvn  figure head signal           card present        read data                 read strobe                      head   x  x     mag  cr r c tek head   x  x       x  x x  x    r xx r c     x x  x     vdc        x  r  x     x            c   r c   data x                  x            strobe card present    x                   x   x    c r   gnd             x          x  rresistor value nt given ccapacitor value nt given xconnection wire mag tek magtek  listing  using several externally defined routine sample program read stripe store buffer short public readmag extern msbuf xdata sample buffer extern mslim number sample limit extern mdbuf xdata decode buffer extern cp bit card present bit extern mclk bit clock bit extern mdq bit data bit ms equ start sentinel me equ fh end sentinel seg code sample decode magnetic track output acc contains character count dptr point data buffer readmag proc call magsample jz l rm call magdecode l rm ret endproc generalpurpose magnetic sampling routine output acc contains sample count magsample proc mov dptr msbuf mov r sample counter l m mov r bit counter l m jb cp l m jb mclk l m mov c mdq l m jb cp l m jnb mclk l m cpl c rrc djnz r l m movx dptr inc dptr inc r sample counter cjne r mslim l m l m mov r final sample count ret endproc  listing  serial bit stream acquired decoding algorithm take bidirectional magnetic track decode routine input sample count acc output acc contains character count dptr point decoded data buffer reg usage routine includes subroutine follows r direction flag forward r cumulative lrc register r decoded character counter r nondecrementing sample count r decrementing sample count r bit syncronizing counter magdecode proc st pas setup forward decode attempt mov r indicate forward decode mov dptr msbuf point start buffer mov r sample counter mov r sample count jmp l md l md nd pas setup reverse decode attempt mov r indicate reverse decode mov dptr msbuf mov r sample count dec add dpl mov dpl clr addc dph mov dph point end buffer mov r sample counter l md decode initialization mov r character counter mov r inital lrc mov r bit syncronizer call findstart main decode loop jnc l md start bit error call getchar start sentinel jb acc l md format error cjne ms l md start setinel error l md data byte end sentinel call getchar jb acc l md format error cjne me l md end sentinel found jmp l md l md call storechar data character jmp l md l md lrc call getchar get lrc jb acc l md format error mov r jnz l md lrc error mov dptr mdbuf good return mov r final character ret l md decode error check st pas cjne r l md check direction clr bad return ret endproc  listing  intermediate layer software one level removed nittygritty detail get next bit sample buffer output c contains data bit getbit proc cjne r l gb bit synchronizer mov r push acc movx dptr call indexptr mov b pop acc dec r sample counter l gb xch b call positionbit xch b dec r bit synchronizer ret endproc find first bit sample buffer output c bit found findstart proc l f cjne r l f bit synchronizer mov r movx dptr call indexptr djnz r l f sample counter jmp l f sample l f call locatebit test bit jc l f call positionbit dec r bit synchronizer jmp l f l f good return mov b save copy b setb c ret l f clr c bad return ret endproc get next bit element sample buffer output acc contains data element error flag acc getchar proc mov r sample counter jz l gc sample mov r bit counter clr l gc call getbit next bit rrc djnz r l gc rr jnb p l gc parity error anl fh discard parity push acc xrl r calculate lrc mov r pop acc good return ret l gc setb acc bad return ret endproc translate store data character input acc contains data character storechar proc push dpl push dph push acc mov dptr mdbuf mov r character counter add dpl mov dpl clr addc dph generate displacement mov dph pop acc add translate movx dptr store pop dph pop dpl inc r character counter ret endproc  listing  lowlevel routine get right ground take care gory detail index sample pointer either forward backward indexptr proc cjne r l ip check direction inc dptr forward ret l ip push acc backward dec dpl mov dpl cjne  l ip dec dph l ip pop acc ret endproc position bit acc c either right left shift positionbit proc cjne r l pb check direction rrc forward ret l pb rlc ret endproc locate bit either msb lsb output c bit one locatebit proc cjne r l lb check direction mov c acc forward ret l lb mov c acc backward ret endproc  contact magtek inc annalee ave carson ca  fax        clafave holonetnet     beaverton oregon usa       go blazer 