j e file transfer system compliment richard b johnson program exchange  december general first let get msdos registered trademark microsoft corporation ibm ibmpc ibmxt registered trademark international business machine inc wildcat trademark mustang software xmodem publicdomain filetransfer protocol developed ward christensen jmodem released public domain publicdomain protocol advised implied warranty kind sourcecode provided may determine program may serve useful purpose written microsoft masm assemblylanguage using good standard engineering practice use strange  undocumented  function msdos operating system please upload file arc file many bb system get installed around country introduction jmodem new filetransfer protocol developed used  external protocol  bb system personal computer using ibmpcatxt structure msdos operating system filetransfer system feature bit crc verification file size exactly maintained data compression rapid hostremote synchronization variablelength transmission block error increase databytes length flow control automatic hangup protection aborted file saved file overwritten renamed  old  rather deleted com com support interrupt received character allows data received previous block written disk provides almost continuous data transmission without long wait block jmodem protocol page jmodem everyone pretty screen dazzle user designed maximize amount data transferred given time reduce telephone cost sending long block data encoding compressing data wherever possible since long block data subject many transmission error bit crc used determine data integrity many ten retries made data correctly received noisy telephone circuit find jmodem abort often xmodem protocol sends short block future version downwardcompatible existing version developed  heroic  retries even go byte blocklengths necessary get data transferred synchronization remote computer host established jmodem paint status block screen show file transfer going status screen show block transmitted last ceived length block total byte transmitted received special synchronization routine used first block thrown away happens often xmodem type routine synchronization routine host waiting user enter proper file parameter second wait abort immediately sending control x x actual file transfer begin ie see status window screen input keyboard po sible send control break abort transmission c case program abort block sentreceived complete could take second long block patient event carrier lost user disconnected filetransfer program also abort could take long second jmodem logic determine modem carrier present started allow transfer file computer wire without tie rlsd lead high work block size start byte actual byte file  whichever le added byte overhead block transfer occurred without retries block length increased byte byte long transmission successful without incurring retries blocklength increase maximum byte still byte overhead maximum block length actually byte time retries block length next new string decreased byte string length never reduced le byte due jmodem protocol page error last byte read file block length may little byte one data byte plus byte overhead file size received exactly file size transmitted xmodem  roundup  file size next higher block mean m do comp compare always fail attempt check file sent xmodem many protocol file read attempt made compress data using wellknown rll process multiple byte compressed byte statement instance string look like hex get compressed bb f  byte repeat  high byte repeat length  low byte repeat length  sentinel byte sentinelbyte bbh encountered data stream get expanded four byte therefore possible  compressed  data string actually longer original occurs original string sent rather longer encoded one since kind data sent different blocktoblock necessary send controlbyte along data receiver determine operate data control structure b  ea  crc  crc  data  rec  control  length  length two byte used string length two byte used crc standard memory highbyte look  people using debug  swapped low byte data transmitted exactly memory image length word begin string receiver may know exactly may byte receive control byte bitmapped possibility one important normal data jmodem protocol page compressed data end file abort receiver  know  data crc generated using polynomial x x x nmod   n n string length advantage simplicity assemblylanguage programming detect error probability one undetected error  large number correct error important use  standard  function generate crc support com com added revision level v note standard port location de facto standard may port actually used computer please modify communication port structure beginning assemblylanguage program match system parameter different modification done structure equates revision level v brings musical exit status file transfer successful computer play  victory  file transfer aborted computer play  retreat  since bb sysop unlikely want computer play buglecalls well evening user option turning music done setting environment variable string set jmodemshutup  accomplish desired result usage program us parameter command line jmodem filenametyp sends file com jmodem r filenametyp receives file com jmodem filenametyp sends file com jmodem r filenametyp receives file com jmodem filenametyp sends file com jmodem r filenametyp receives file com version  jmodem supported communication adapter port batch file filenametyp may substitution character jmodem sends file com jmodem r receives file com jmodem protocol page jmodem protocol page setting communication program external filetransfer protocol system telix resides c telix directory copy jmodemcom also directory telix pass filename parameter therefore content jupbat c telixjmodem content jdownbat c telixjmodem r wished receive  batch  mode could make file like notice communication program allow multiple file name note comment   allowed do batch file doloop return      goto done parameter c telixjmodem r execute jmodem errorlevel goto done abort error shift becomes goto doloop continue done exit batch file know   parameter used pas file name make  dummy  batch file contains following echo echo echo echo echo echo pause executed see something like filenametyp echo echo strike key ready first line contains   baud rate mean parameter contains baud rate second line contains   communication adapter port used mean port passed parameter jmodem protocol page third line contains  filenametyp  file name mean file name passed parameter fourth fifth line contain nothing echo do reply current state echo function   pcplus handle file name passing little bit different execute  dummy  batch file pcplus directory response filenametyp echo echo echo echo strike key ready show u pcplus pass file name first parameter parameter however put parameter command line within pcplus get sent batch file response filename filename filename filename echo strike key ready therefore pcplus allows four file name passed providing room command line notice two communication program check default directory external protocol batch file first therefore must make certain similarlynamed batch file current directory within current path failure cause improper execution wrong batch file let say path  c do c tool c pcplus c telix c qmodem  named jmodem external protocol batch file name attempting use external file transfer protocol qmodem batch file designed operate pcplus would first one  found  executed since searchpath search pcplus directory qmodem directory prevent execution incorrect batch file calling slightly different name setting external protocol remember configure communication program prompt file name unlike protocol jmodem transfer jmodem protocol page file name use file name wish must pas file name jmodem since must know name file transmitted received default jmodem protocol page setting bb system external filetransfer protocol running wildcat bulletin board external protocol file set like jupbat cd wildcatprotocol exist transferbad del transferbad jmodem r errorlevel goto end copy end del jdownbat cd wildcatprotocol exist transferbad del transferbad jmodem errorlevel goto bad goto end bad copy allok transferbad end many variation available since wildcat support batchmode downloading could set batch file like jdownbat cd wildcatprotocol exist transferbad del transferbad doloop      goto end jmodem errorlevel goto bad shift goto doloop bad copy allok transferbad end wildcat check protocol directory see file transferbad created exists announces file transfer failed also announces  error external protocol   fact wildcat made error many case wildcat  find  file transferbad exist spite bug wildcat one reliable bb system supporting external protocol setting batch file remember also bug do version  errorlevel  statement jmodem protocol page test actual value errorlevel instead check see returned value equal greater tested value put statement errorlevel goto good  batch file execution would always branch label  good  regardless actual errorlevel returned bug get  bad bb  section towards end jmodem require information handshaking look modem port figure event modem carrier lost jmodem abort since jmodem check modem port occasionally may take several second abort carrier lost impossible user get do level jmodem use ctty command external protocol batch file jmodem return errorlevel error transmission reception return errorlevel error otherwise delete file partially received although properly close system operator arrange batch file delete required jmodem attempt create file already exists ca nt ask user old one deleted since user probably terminal program time therefore jmodem renames file filenameold creates new file event filanameold exists deleted rename operation occurs nt know parameter sent external protocol make dummy batch file check using do echo command explained user interface previous  bb  section ca nt see parameter echoed remote terminal must present bb board terminal test parameter unless modify dummy command file like echo echo com echo com echo com echo com echo com find system pass file name  upload  receive batch file would contain jmodem r jmodem protocol page  download  send batch file would contain jmodem example assumed using communication adapter port   jmodem protocol page bad bb problem believe several fine running bb system use properly handle external proto col msdos provides proper mechanism loading executing  child  program within  parent  program function bh  do  int h do interface instead using function poorly behaved program perform external filetransfer protocol following similar manner make do call find filesize external filetransfer protocol free array memory  stringspace  within program large enough copy external file transfer content assumption dataspace required external file transfer program made based upon  blocksize  information entered configuration load file stringspace memory  exe  file ignore header call first byte code jmodem run environment crash system jmodem assumes placed memory msdos entire segment k available run jmodem us two buffer almost k length one buffer used support data compression expansion used interrupt buffer bb system wish run jmodem make simple modification sourcecode recompile produce version bit slower initialize exit guaranteed leave memory register exactly jmodem got control done saving restoring register additionally data space modified copied file called virtualmem restored file jmodem exit modify sourcecode finding  badbbs  equate near beginning file normally set  false  set  true  recompile following manner masm jmodem link jmodem exebin jmodemexe jmodemcom del jmodemexe jmodem protocol page attempt execute  exe  version must change jmodem  com  file exebincom make change use do debug thing way f dev debug jmodemexe do command line rcx examine cx register cx debug say size h  calculate h h sum h dif h rcx examine register cx h  change h  subtract h njmodemcom name new save file name w write file writing byte debug prompt q exit f dev back do use version jmodem take little longer load exit must write k block memory file read delete upon exit jmodem protocol page thing nt work early version jmodem assumed properly loaded either commandcom resident command processor  parent  process properly executes do function bh exec function much surprise found much bb system software written properly starting version v included  badbbs  routine help overcome loading problem bb system case workaround successful others version v included test verify whether jmodem loaded properly instead crashing system jmodem print error message exit error message help find problem hopefully obtain solution presently jmodem loaded one first thing make do call give memory except contains code do return error mean jmodem loaded properly therefore doesnt memory give error message appears telling jmodem nt memory must contact writer bb system software obtain version bug fixed way execute jmodem kind environment without risking serious system crash next thing jmodem make do call requesting k  byte memory necessary buffer space do call fails message printed stating enough memory available jmodem case simply reconfigure bb software provide enough memory external protocol bb system done defining  blocksize  generally specify largest number bb software accept therefore force bb system software allocate large block memory external protocol although code size jmodem small around k requires much memory external protocol memory used three major buffer data buffer byte encodedecode buffer  byte interrupt buffer  byte buffer put separate segment wild bit stream input cause system crash index used addressing memory interrupt buffer simply wrap around past k back zero course get data error happens crash incoming bit stream end timeout error recoverable satellite link lose lock result usually second burst noise random bitstream jmodem protocol page baud easily overflow buffer large enough allowed wrap alternative method limit size buffer check limit every time byte put buffer jmodem nt two reason first increased software overhead check must made every byte interrupt service routine second may waiting ack jmodem always preserve last byte buffer even noisy reversechannel acknak extracted error message mean jmodem error message specified file   found mean file name passed jmodem command line download jmodem error message specified file  pathfilenametyp  found mean incorrect file name passed jmodem command line download jmodem error message specified file   ca nt created mean file name passed jmodem command line upload jmodem error message specified file  pathfilenametyp  ca nt created mean incorrect file name passed jmodem command line upload path nt exist drive nt exist enough file handle put file configsys reboot attempt write network drive networked install share jmodem error message file transfer aborted normal abort user nt abort active communication adapter port passed jmodem correctly jmodem protocol page jmodem error message modem carrier failed modem either online user hung protocol execution jmodem error message ca nt execute free ram poorlywritten bb system attempted load program subroutine execute contact bb software writer jmodem error message program already loaded resident code system probably crash poorlywritten bb system loaded jmodem code jmodem error message ca nt create file virtualmem jmodem error message ca nt write file virtualmem jmodem error message ca nt close file virtualmem jmodem error message ca nt open file virtualmem jmodem error message ca nt delete file virtualmem compiled badbbs system conditional set  true  jmodem unable required file io something screwed bb software enough file handle available enter file configsys reboot also happen share installed network exists use share networked jmodem error message do report jmodem improperly loaded memory using bb system software either improperly configured improperly written external protocol contact writer bb system software jmodem error message enough free memory jmodem use bb system software properly configured give jmodem memory requires execute check bb system software documentation reconfigure problem using jmodem system call program exchange leave message also test communication program external filetransfer protocol transferring file hopefully uploading program exchange currently hundred board jmodem protocol page using protocol number growing every day problem encountered found caused incorrect file name sent jmodem wrong   parameter simple batch file test parameter go long way towards solving problem richard b johnson program exchange  boulder colorado finis 